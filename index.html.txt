<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>家庭用药避坑指南 | 旗舰版</title>
    
    <!-- 国内极速 CDN 源 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/tailwind.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/babel-standalone/7.22.17/babel.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/tesseract.js/5.0.3/tesseract.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #dc2626; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // 图标组件
        const Icons = {
            Shield: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>,
            Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>,
            Camera: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path strokeLinecap="round" strokeLinejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>,
            Alert: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>,
            Close: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"></path></svg>,
            ChevronDown: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7"></path></svg>
        };

        // 50+种 高危药物数据库
        const drugDatabase = [
            { id: 1, name: "安乃近", keywords: ["安乃近", "Metamizole", "Analgin", "大药片", "退烧针"], riskLevel: "❌ 国家注销", harm: "致死性粒细胞缺乏症，严重过敏休克。", consequence: "国家药监局公告：停止生产，注销批文。", alternatives: "布洛芬、对乙酰氨基酚" },
            { id: 2, name: "尼美舒利", keywords: ["尼美舒利", "Nimesulide", "瑞芝清"], riskLevel: "❌ 12岁禁用", harm: "严重肝衰竭，致死率高。", consequence: "国家食药监局通知：12岁以下禁用。", alternatives: "布洛芬" },
            { id: 3, name: "阿司匹林", keywords: ["阿司匹林", "Aspirin", "巴米尔"], riskLevel: "❌ 儿童发烧禁用", harm: "瑞氏综合征(脑病+肝损)，死亡率30%。", consequence: "儿童发烧绝对禁用。", alternatives: "布洛芬" },
            { id: 4, name: "氨基比林", keywords: ["氨基比林", "APC", "去痛片", "安痛定"], riskLevel: "⚠️ 淘汰药", harm: "血液毒性(白细胞减少)，伤肾。", consequence: "毒副作用大，已淘汰。", alternatives: "布洛芬" },
            { id: 5, name: "赖氨匹林", keywords: ["赖氨匹林", "退烧针"], riskLevel: "❌ 16岁以下慎用", harm: "同阿司匹林，注射更容易引起瑞氏综合征。", consequence: "说明书警示。", alternatives: "口服退烧药" },
            { id: 6, name: "保泰松", keywords: ["保泰松", "Phenylbutazone"], riskLevel: "⚠️ 高毒性", harm: "再生障碍性贫血(血癌)，胃出血。", consequence: "已被淘汰。", alternatives: "其他NSAIDs" },
            { id: 7, name: "阿米卡星", keywords: ["阿米卡星", "AKC", "丁胺卡那"], riskLevel: "⚠️ 儿童慎用", harm: "耳毒性(致聋) + 肾毒性。", consequence: "普通感冒属于过度医疗。", alternatives: "头孢类" },
            { id: 8, name: "庆大霉素", keywords: ["庆大霉素", "Gentamicin", "GM"], riskLevel: "⚠️ 儿童慎用", harm: "一针致聋风险，不可逆。", consequence: "未成年人应慎用。", alternatives: "头孢类" },
            { id: 9, name: "诺氟沙星", keywords: ["诺氟沙星", "氟哌酸", "沙星"], riskLevel: "❌ 18岁禁用", harm: "导致软骨发育不良，长不高，肌腱断裂。", consequence: "说明书禁忌。", alternatives: "蒙脱石散" },
            { id: 10, name: "左氧氟沙星", keywords: ["左氧氟沙星", "Levofloxacin", "沙星"], riskLevel: "❌ 18岁禁用", harm: "影响骨骼发育，长不高。", consequence: "说明书禁忌。", alternatives: "头孢类" },
            { id: 11, name: "四环素", keywords: ["四环素", "土霉素"], riskLevel: "❌ 8岁禁用", harm: "四环素牙(牙齿变黑)，牙釉质发育不全。", consequence: "不可逆损伤。", alternatives: "阿奇霉素" },
            { id: 12, name: "氯霉素", keywords: ["氯霉素", "Chloramphenicol"], riskLevel: "❌ 新生儿禁用", harm: "灰婴综合征(循环衰竭)，骨髓抑制。", consequence: "极少使用。", alternatives: "其他抗生素" },
            { id: 13, name: "呋喃唑酮", keywords: ["呋喃唑酮", "痢特灵"], riskLevel: "⚠️ 高风险", harm: "多发性神经炎，溶血性贫血。", consequence: "老药，副作用大。", alternatives: "蒙脱石散" },
            { id: 14, name: "可待因", keywords: ["可待因", "罂粟壳", "强力枇杷露", "复方甘草片", "克咳"], riskLevel: "❌ 18岁禁用", harm: "阿片类毒品成分，成瘾，抑制呼吸。", consequence: "国家药监局：18岁以下禁用。", alternatives: "右美沙芬" },
            { id: 15, name: "异丙嗪", keywords: ["异丙嗪", "非那根", "PMZ"], riskLevel: "❌ 2岁禁用", harm: "呼吸抑制致死。", consequence: "WHO警示：绝对禁用于2岁以下。", alternatives: "海盐水" },
            { id: 16, name: "萘甲唑啉", keywords: ["萘甲唑啉", "滴鼻净"], riskLevel: "❌ 儿童禁用", harm: "药物中毒，休克，昏迷。", consequence: "容易吸收中毒。", alternatives: "生理海盐水" },
            { id: 17, name: "艾畅(老版)", keywords: ["伪麻美芬", "艾畅"], riskLevel: "❌ 国家注销", harm: "含伪麻黄碱，婴幼儿风险高。", consequence: "国家药监局注销。", alternatives: "海盐水" },
            { id: 18, name: "金刚烷胺", keywords: ["金刚烷胺", "优卡丹", "好娃娃", "快克"], riskLevel: "⚠️ 5岁慎用", harm: "肝肾毒性，对流感无效。", consequence: "国家药监局修订说明书。", alternatives: "单一退烧药" },
            { id: 19, name: "特非那定", keywords: ["特非那定"], riskLevel: "❌ 心脏毒性", harm: "导致严重心律失常，猝死。", consequence: "已被氯雷他定取代。", alternatives: "氯雷他定" },
            { id: 20, name: "柴胡注射液", keywords: ["柴胡注射液"], riskLevel: "❌ 儿童禁用", harm: "过敏性休克致死。", consequence: "国家药监局公告。", alternatives: "布洛芬" },
            { id: 21, name: "双黄连注射液", keywords: ["双黄连"], riskLevel: "❌ 4岁禁用", harm: "严重过敏反应，休克。", consequence: "国家药监局公告。", alternatives: "口服中成药" },
            { id: 22, name: "茵栀黄注射液", keywords: ["茵栀黄"], riskLevel: "❌ 新生儿禁用", harm: "曾致新生儿死亡。", consequence: "国家药监局公告。", alternatives: "蓝光照射" },
            { id: 23, name: "喜炎平", keywords: ["喜炎平"], riskLevel: "⚠️ 慎用", harm: "全身性过敏反应，呼吸困难。", consequence: "不良反应通报。", alternatives: "口服药" },
            { id: 24, name: "穿琥宁/炎琥宁", keywords: ["穿琥宁", "炎琥宁"], riskLevel: "⚠️ 慎用", harm: "过敏性休克发生率高，血小板减少。", consequence: "不良反应通报。", alternatives: "口服药" },
            { id: 25, name: "何首乌(生)", keywords: ["何首乌", "首乌"], riskLevel: "⚠️ 肝毒性", harm: "药物性肝损伤，严重可致肝衰竭。", consequence: "需遵医嘱。", alternatives: "无" },
            { id: 26, name: "土三七", keywords: ["土三七", "菊三七"], riskLevel: "❌ 剧毒", harm: "肝窦阻塞综合征(肝腹水)，死亡率极高，无药可治。", consequence: "绝对禁用。", alternatives: "正规三七" },
            { id: 27, name: "朱砂/雄黄", keywords: ["朱砂", "雄黄", "七厘散"], riskLevel: "⚠️ 重金属", harm: "汞中毒、砷中毒，伤脑伤肾。", consequence: "长期服用慢性中毒。", alternatives: "无" },
            { id: 28, name: "含马兜铃酸", keywords: ["关木通", "广防己", "青木香", "马兜铃"], riskLevel: "❌ 肾衰竭", harm: "马兜铃酸肾病，尿毒症，不可逆。", consequence: "国家已取消药用标准。", alternatives: "无" },
            { id: 29, name: "槟榔", keywords: ["槟榔"], riskLevel: "❌ 一级致癌", harm: "口腔癌，成瘾。", consequence: "世界卫生组织认定。", alternatives: "口香糖" },
            { id: 30, name: "酚酞片", keywords: ["酚酞", "果导片"], riskLevel: "❌ 国家注销", harm: "严重致癌风险。", consequence: "国家药监局注销。", alternatives: "乳果糖" },
            { id: 31, name: "洛哌丁胺", keywords: ["洛哌丁胺", "易蒙停"], riskLevel: "❌ 2岁禁用", harm: "肠麻痹，肠坏死，中毒性巨结肠。", consequence: "2岁以下禁用。", alternatives: "蒙脱石散" },
            { id: 32, name: "多潘立酮", keywords: ["多潘立酮", "吗丁啉"], riskLevel: "⚠️ 12岁慎用", harm: "心脏猝死(QT间期延长)。", consequence: "欧美限制使用。", alternatives: "益生菌" },
            { id: 33, name: "西布曲明", keywords: ["西布曲明", "减肥药"], riskLevel: "❌ 全球禁用", harm: "增加心脏病和中风风险。", consequence: "已注销。", alternatives: "运动" },
            { id: 34, name: "地塞米松", keywords: ["地塞米松", "DXM", "激素"], riskLevel: "⚠️ 慎用", harm: "滥用退烧掩盖病情，降低免疫力。", consequence: "单纯感冒不应常规使用。", alternatives: "布洛芬" },
            { id: 35, name: "利巴韦林", keywords: ["利巴韦林", "病毒唑"], riskLevel: "⚠️ 不推荐", harm: "致畸，贫血。", consequence: "对感冒流感无效。", alternatives: "奥司他韦" },
            { id: 36, name: "强效激素膏", keywords: ["氯倍他索", "特美肤"], riskLevel: "⚠️ 儿童慎用", harm: "皮肤萎缩，激素依赖，抑制生长。", consequence: "应选弱效激素。", alternatives: "尤卓尔" },
            { id: 37, name: "林旦乳膏", keywords: ["林旦", "六六六"], riskLevel: "❌ 禁用", harm: "中枢神经毒性，诱发癫痫。", consequence: "已淘汰。", alternatives: "硫软膏" },
            { id: 38, name: "硼酸/硼砂", keywords: ["硼酸", "硼砂"], riskLevel: "❌ 婴幼儿禁用", harm: "蓄积中毒，大面积使用致死。", consequence: "禁用。", alternatives: "氧化锌" },
            { id: 39, name: "一滴香(蚊香)", keywords: ["一滴香", "氟虫腈"], riskLevel: "⚠️ 剧毒", harm: "农药成分，神经毒性。", consequence: "慎用。", alternatives: "电蚊香液" },
            { id: 40, name: "头孢地尼", keywords: ["头孢地尼", "Cefdinir"], riskLevel: "✅ 安全抗生素", harm: "对症药物，请遵医嘱服用。", consequence: "三代头孢，针对呼吸道。", alternatives: "无" },
            { id: 41, name: "阿奇霉素", keywords: ["阿奇霉素", "Azithromycin"], riskLevel: "✅ 支原体特效", harm: "注意胃肠反应，吃3停4。", consequence: "支原体首选。", alternatives: "无" }
        ];

        const App = () => {
            const [status, setStatus] = useState("idle");
            const [result, setResult] = useState(null);
            const fileInputRef = useRef(null);

            // 处理图片识别
            const handleImage = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setStatus("scanning");
                setResult(null);

                try {
                    const worker = await Tesseract.createWorker({
                        logger: m => console.log(m) // 可选：查看进度
                    });
                    // 加载中英文
                    await worker.loadLanguage('eng+chi_sim');
                    await worker.initialize('eng+chi_sim');
                    const { data: { text } } = await worker.recognize(file);
                    await worker.terminate();
                    analyzeText(text);
                } catch (error) {
                    console.error(error);
                    alert("首次加载可能较慢(需下载语言包)，请保持网络通畅，或者刷新页面重试。");
                    setStatus("idle");
                }
            };

            const analyzeText = (text) => {
                const cleanText = text.replace(/\s+/g, "").toUpperCase();
                // 模糊匹配
                const matches = drugDatabase.filter(drug => 
                    drug.keywords.some(k => cleanText.includes(k.toUpperCase()))
                );
                
                if (matches.length > 0) {
                    // 优先显示最高危的
                    const highRisk = matches.find(d => d.riskLevel.includes("❌")) || matches[0];
                    setResult(highRisk);
                    setStatus("success");
                } else {
                    setStatus("not_found");
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-200 pb-10 font-sans text-slate-800">
                    {/* 头部 */}
                    <div className="bg-red-700 text-white p-5 sticky top-0 z-20 shadow-xl rounded-b-2xl">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <Icons.Shield />
                                <div>
                                    <h1 className="text-xl font-bold tracking-wide">家庭用药避坑指南</h1>
                                    <p className="text-[10px] opacity-80 font-mono">旗舰版 50+ 数据库</p>
                                </div>
                            </div>
                            <div className="bg-white/20 px-2 py-1 rounded text-xs font-bold">离线可用</div>
                        </div>
                    </div>

                    {/* 搜索栏 */}
                    <div className="px-4 -mt-6 relative z-30">
                        <div className="bg-white rounded-2xl shadow-lg p-2 flex items-center gap-2">
                            <div className="pl-2 text-slate-400"><Icons.Search /></div>
                            <input 
                                type="text" 
                                className="flex-1 p-3 outline-none text-slate-700 bg-transparent"
                                placeholder="输入药名 (如: 土三七、AKC...)"
                                onChange={(e) => analyzeText(e.target.value)}
                            />
                            <button 
                                onClick={() => fileInputRef.current.click()}
                                className="bg-red-600 text-white p-3 rounded-xl shadow-md active:scale-95 transition-all"
                            >
                                {status === "scanning" ? <div className="loader"></div> : <Icons.Camera />}
                            </button>
                        </div>
                    </div>

                    {/* 结果展示区 */}
                    <div className="px-4 mt-6">
                        {status === "success" && result && (
                            <div className="bg-white rounded-3xl shadow-xl border-t-4 border-red-600 overflow-hidden animate-fade-in">
                                <div className="bg-red-50 p-5 border-b border-red-100">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h2 className="text-2xl font-bold text-red-900">{result.name}</h2>
                                            <span className={`inline-block mt-2 px-3 py-1 text-white text-xs font-bold rounded-full shadow-sm ${result.riskLevel.includes('✅') ? 'bg-green-600' : 'bg-red-600'}`}>
                                                {result.riskLevel}
                                            </span>
                                        </div>
                                        <Icons.Alert />
                                    </div>
                                </div>
                                <div className="p-6 space-y-5">
                                    <div>
                                        <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">核心危害</h4>
                                        <p className="text-slate-800 font-medium leading-relaxed bg-red-50/50 p-3 rounded-lg border border-red-100">
                                            {result.harm}
                                        </p>
                                    </div>
                                    <div>
                                        <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">权威依据</h4>
                                        <p className="text-xs text-slate-500 bg-slate-100 p-2 rounded">
                                            {result.consequence}
                                        </p>
                                    </div>
                                    {!result.riskLevel.includes('✅') && (
                                        <div>
                                            <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">建议替代</h4>
                                            <div className="flex items-center gap-2 text-green-700 bg-green-50 p-3 rounded-lg border border-green-100">
                                                <Icons.Check />
                                                <span className="font-bold">{result.alternatives}</span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {status === "not_found" && (
                            <div className="bg-white rounded-2xl p-6 text-center shadow-sm border border-slate-200">
                                <p className="text-slate-500 font-medium">未在危险名单中找到该药</p>
                                <p className="text-xs text-slate-400 mt-1">但这不代表绝对安全，请阅读说明书禁忌。</p>
                            </div>
                        )}

                        {/* 默认列表 (展示部分高危) */}
                        {status === "idle" && (
                            <div className="space-y-3 mt-2">
                                <p className="text-xs font-bold text-slate-400 ml-2 uppercase">常见高危药物速查</p>
                                {drugDatabase.slice(0, 8).map(drug => (
                                    <div key={drug.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center active:bg-slate-50" onClick={()=>{setResult(drug); setStatus('success')}}>
                                        <div>
                                            <div className="font-bold text-slate-800">{drug.name}</div>
                                            <div className="text-xs text-slate-500 truncate w-48">{drug.harm}</div>
                                        </div>
                                        <span className="text-[10px] px-2 py-1 rounded font-bold bg-red-100 text-red-600">
                                            {drug.riskLevel.split(' ')[0]}
                                        </span>
                                    </div>
                                ))}
                                <p className="text-center text-xs text-slate-400 pt-2">... 更多药物请输入名称查询</p>
                            </div>
                        )}
                    </div>

                    <input type="file" ref={fileInputRef} accept="image/*" className="hidden" onChange={handleImage} />
                    <div className="h-10"></div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>