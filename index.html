<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>家庭用药避坑指南 | 旗舰实战版</title>
    
    <!-- 1. 国内极速 CDN 核心库 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/tailwind.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/babel-standalone/7.22.17/babel.min.js"></script>
    <!-- 引入 Tesseract.js (真实OCR引擎) -->
    <script src="https://cdn.bootcdn.net/ajax/libs/tesseract.js/5.0.3/tesseract.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        /* 动画效果 */
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(to right, transparent, #a855f7, transparent); animation: scanning 1.5s infinite; z-index: 10; }
        @keyframes scanning { 0% { top: 0; } 100% { top: 100%; } }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- 2. 图标组件库 (内置SVG，确保极速加载) ---
        const Icons = {
            Shield: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>,
            Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>,
            Camera: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path strokeLinecap="round" strokeLinejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>,
            Image: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>,
            AlertTriangle: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>,
            AlertOctagon: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>,
            XCircle: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>,
            Gavel: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72l1.189-1.19A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z"></path></svg>,
            ShieldCheck: () => <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" /></svg>,
            ChevronDown: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7"></path></svg>,
            Tag: () => <svg className="w-3 h-3" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>,
            Loader: () => <svg className="w-6 h-6 animate-spin" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
        };

        // --- 3. 终极全量数据库 (50+种) ---
        const drugDatabase = [
            // 1. 退烧止痛
            { id: 1, name: "安乃近", abbr: "Analgin", aliases: ["大药片", "退烧针", "诺瓦金"], category: "退烧止痛", riskLevel: "❌ 国家注销 (极高危)", riskColor: "bg-red-600 text-white", harm: "【致死】粒细胞缺乏症（免疫瘫痪）；严重过敏性休克。", consequence: "国家药监局公告：停止生产，注销批文。", alternatives: "布洛芬、对乙酰氨基酚" },
            { id: 2, name: "尼美舒利", abbr: "Nimesulide", aliases: ["瑞芝清", "退烧颗粒"], category: "退烧止痛", riskLevel: "❌ 12岁以下禁用", riskColor: "bg-red-600 text-white", harm: "【肝衰竭】严重肝毒性，致死率高。", consequence: "国家食药监局通知：禁止用于12岁以下。", alternatives: "布洛芬、对乙酰氨基酚" },
            { id: 3, name: "阿司匹林", abbr: "Aspirin", aliases: ["巴米尔", "ASA"], category: "退烧止痛", riskLevel: "❌ 16岁以下发烧禁用", riskColor: "bg-red-600 text-white", harm: "【瑞氏综合征】致死性脑病+肝损，死亡率30%。", consequence: "儿童病毒感染发烧禁用。", alternatives: "布洛芬" },
            { id: 4, name: "氨基比林", abbr: "APC", aliases: ["去痛片", "安痛定"], category: "退烧止痛", riskLevel: "⚠️ 淘汰药", riskColor: "bg-orange-500 text-white", harm: "【血液毒性】粒细胞减少，伤肾。", consequence: "已被更安全药物替代。", alternatives: "布洛芬" },
            { id: 5, name: "赖氨匹林", abbr: "Lys-Asp", aliases: ["退烧针"], category: "退烧止痛", riskLevel: "❌ 16岁以下慎用", riskColor: "bg-red-600 text-white", harm: "同阿司匹林，注射更容易引起瑞氏综合征。", consequence: "说明书警示。", alternatives: "口服退烧药" },
            { id: 6, name: "保泰松", abbr: "Phenylbutazone", aliases: ["风湿药"], category: "止痛药", riskLevel: "❌ 高毒性", riskColor: "bg-red-600 text-white", harm: "可引起再生障碍性贫血（血癌），胃出血。", consequence: "已被淘汰。", alternatives: "其他NSAIDs" },

            // 2. 抗生素
            { id: 7, name: "阿米卡星", abbr: "AKC", aliases: ["AMK", "丁胺卡那"], category: "抗生素", riskLevel: "⚠️ 儿童慎用 (高危)", riskColor: "bg-orange-500 text-white", harm: "【耳毒性+肾毒性】听力下降甚至耳聋；损伤肾脏。", consequence: "普通感冒用此药属于过度医疗。", alternatives: "头孢类" },
            { id: 8, name: "庆大霉素", abbr: "GM", aliases: ["Gentamycin", "针剂"], category: "抗生素", riskLevel: "⚠️ 儿童慎用 (高危)", riskColor: "bg-orange-500 text-white", harm: "【耳毒性】一针致聋风险，不可逆。", consequence: "未成年人应慎用。", alternatives: "头孢类" },
            { id: 9, name: "诺氟沙星", abbr: "Norfloxacin", aliases: ["氟哌酸", "沙星"], category: "抗生素", riskLevel: "❌ 18岁禁用", riskColor: "bg-red-600 text-white", harm: "【骨骼损伤】影响软骨发育，长不高，肌腱断裂。", consequence: "说明书禁忌：18岁以下禁用。", alternatives: "蒙脱石散" },
            { id: 10, name: "左氧氟沙星", abbr: "LVFX", aliases: ["Levofloxacin", "沙星类"], category: "抗生素", riskLevel: "❌ 18岁禁用", riskColor: "bg-red-600 text-white", harm: "【骨骼损伤】影响软骨发育，长不高。", consequence: "说明书禁忌。", alternatives: "头孢类" },
            { id: 11, name: "四环素", abbr: "TCY", aliases: ["土霉素", "OTC", "强力霉素"], category: "抗生素", riskLevel: "❌ 8岁禁用", riskColor: "bg-red-600 text-white", harm: "【四环素牙】牙齿永久变黑、发育不良。", consequence: "毁容性副作用。", alternatives: "阿奇霉素" },
            { id: 12, name: "氯霉素", abbr: "Chloramphenicol", aliases: [], category: "抗生素", riskLevel: "❌ 新生儿禁用", riskColor: "bg-red-600 text-white", harm: "灰婴综合征(循环衰竭)，骨髓抑制。", consequence: "极少使用。", alternatives: "其他抗生素" },
            { id: 13, name: "呋喃唑酮", abbr: "FZ", aliases: ["痢特灵"], category: "抗生素", riskLevel: "⚠️ 副作用多", riskColor: "bg-orange-500 text-white", harm: "多发性神经炎，溶血性贫血。", consequence: "老药，副作用大。", alternatives: "蒙脱石散" },

            // 3. 止咳/感冒/鼻炎
            { id: 14, name: "可待因", abbr: "Codeine", aliases: ["罂粟壳", "强力枇杷露", "复方甘草片", "克咳"], category: "止咳化痰", riskLevel: "❌ 18岁禁用", riskColor: "bg-red-600 text-white", harm: "【成瘾/窒息】含毒品成分，抑制呼吸。", consequence: "国家药监局公告：18岁以下禁用。", alternatives: "右美沙芬" },
            { id: 15, name: "异丙嗪", abbr: "PMZ", aliases: ["非那根", "Promethazine", "伤风止咳"], category: "止咳/止吐", riskLevel: "❌ 2岁禁用", riskColor: "bg-red-600 text-white", harm: "【呼吸抑制】可能导致幼儿呼吸停止死亡！", consequence: "WHO警示：绝对禁用于2岁以下。", alternatives: "海盐水" },
            { id: 16, name: "萘甲唑啉", abbr: "Naphazoline", aliases: ["滴鼻净", "滴鼻水"], category: "感冒鼻炎", riskLevel: "❌ 儿童禁用", riskColor: "bg-red-600 text-white", harm: "【中毒】易导致儿童休克、昏迷。", consequence: "临床用药须知警示。", alternatives: "海盐水" },
            { id: 17, name: "艾畅(老版)", abbr: "Pseudoephedrine", aliases: ["伪麻美芬", "艾畅"], category: "感冒药", riskLevel: "❌ 国家注销", riskColor: "bg-red-600 text-white", harm: "含伪麻黄碱，婴幼儿风险高。", consequence: "国家药监局注销批文。", alternatives: "海盐水" },
            { id: 18, name: "金刚烷胺", abbr: "Amantadine", aliases: ["优卡丹", "好娃娃", "快克"], category: "抗病毒", riskLevel: "⚠️ 5岁慎用", riskColor: "bg-yellow-500 text-white", harm: "肝肾毒性，对流感无效。", consequence: "国家药监局修订说明书。", alternatives: "单一退烧药" },
            { id: 19, name: "特非那定", abbr: "Terfenadine", aliases: ["敏迪"], category: "抗过敏", riskLevel: "❌ 心脏毒性", riskColor: "bg-red-600 text-white", harm: "【猝死】导致严重心律失常。", consequence: "已被氯雷他定取代。", alternatives: "氯雷他定" },
            { id: 20, name: "小儿氨酚黄那敏", abbr: "Compound", aliases: ["护彤", "小快克"], category: "感冒药", riskLevel: "⚠️ 4岁不推荐", riskColor: "bg-yellow-500 text-white", harm: "复方成分，易导致重复用药中毒。", consequence: "FDA建议4岁以下禁用。", alternatives: "单一退烧药" },
            { id: 21, name: "维C银翘片", abbr: "VC-Yinqiao", aliases: ["银翘片"], category: "感冒药", riskLevel: "⚠️ 易中毒", riskColor: "bg-yellow-500 text-white", harm: "含隐形西药(对乙酰氨基酚)，易致肝损伤。", consequence: "需严格按说明书，不可混吃。", alternatives: "感冒清热颗粒" },

            // 4. 中药/注射液
            { id: 22, name: "柴胡注射液", abbr: "Chaihu", aliases: ["退烧针"], category: "中药注射", riskLevel: "❌ 儿童禁用", riskColor: "bg-red-600 text-white", harm: "【过敏性休克】曾导致多起儿童致死。", consequence: "国家药监局公告。", alternatives: "口服布洛芬" },
            { id: 23, name: "双黄连注射液", abbr: "SHL", aliases: ["双黄连"], category: "中药注射", riskLevel: "❌ 4岁禁用", riskColor: "bg-red-600 text-white", harm: "严重过敏反应，休克。", consequence: "国家药监局公告。", alternatives: "口服中成药" },
            { id: 24, name: "茵栀黄注射液", abbr: "YZH", aliases: ["退黄针"], category: "中药注射", riskLevel: "❌ 新生儿禁用", riskColor: "bg-red-600 text-white", harm: "【死亡风险】曾致新生儿死亡。", consequence: "国家药监局公告。", alternatives: "蓝光照射" },
            { id: 25, name: "喜炎平", abbr: "XYP", aliases: ["喜炎平"], category: "中药注射", riskLevel: "⚠️ 慎用", riskColor: "bg-orange-500 text-white", harm: "全身性过敏反应，呼吸困难。", consequence: "不良反应通报。", alternatives: "口服药" },
            { id: 26, name: "穿琥宁/炎琥宁", abbr: "Potassium", aliases: ["抗病毒针"], category: "中药注射", riskLevel: "⚠️ 慎用", riskColor: "bg-orange-500 text-white", harm: "过敏性休克发生率高，血小板减少。", consequence: "不良反应通报。", alternatives: "口服药" },
            { id: 27, name: "何首乌(生)", abbr: "Heshouwu", aliases: ["首乌"], category: "中草药", riskLevel: "⚠️ 肝毒性", riskColor: "bg-orange-500 text-white", harm: "药物性肝损伤，严重可致肝衰竭。", consequence: "需遵医嘱。", alternatives: "无" },
            { id: 28, name: "土三七", abbr: "TCM Toxic", aliases: ["菊三七"], category: "中草药", riskLevel: "❌ 剧毒", riskColor: "bg-red-600 text-white", harm: "【肝窦阻塞】导致肝腹水、肝衰竭，无药可治。", consequence: "绝对禁用。", alternatives: "正规三七" },
            { id: 29, name: "朱砂/雄黄", abbr: "HeavyMetal", aliases: ["七厘散", "小儿惊风散"], category: "中成药", riskLevel: "⚠️ 重金属", riskColor: "bg-orange-500 text-white", harm: "含汞、砷，伤肝肾、伤脑。", consequence: "长期服用慢性中毒。", alternatives: "无" },
            { id: 30, name: "马兜铃酸", abbr: "AA", aliases: ["关木通", "广防己"], category: "中草药", riskLevel: "❌ 肾衰竭", riskColor: "bg-red-600 text-white", harm: "【尿毒症】直接损伤肾小管，不可逆；致癌。", consequence: "国家已取消药用标准。", alternatives: "无" },
            { id: 31, name: "槟榔", abbr: "Areca", aliases: ["槟榔"], category: "其他", riskLevel: "❌ 一级致癌", riskColor: "bg-red-600 text-white", harm: "口腔癌，成瘾。", consequence: "WHO认定。", alternatives: "口香糖" },

            // 5. 消化/激素/其他
            { id: 32, name: "地塞米松", abbr: "DXM", aliases: ["激素", "地塞"], category: "激素", riskLevel: "⚠️ 慎用", riskColor: "bg-orange-500 text-white", harm: "滥用退烧掩盖病情，降低免疫力。", consequence: "单纯感冒不应常规使用。", alternatives: "布洛芬" },
            { id: 33, name: "利巴韦林", abbr: "RBV", aliases: ["病毒唑"], category: "抗病毒", riskLevel: "⚠️ 不推荐", riskColor: "bg-yellow-500 text-white", harm: "致畸，贫血。", consequence: "对感冒流感无效。", alternatives: "奥司他韦" },
            { id: 34, name: "多潘立酮", abbr: "DOM", aliases: ["吗丁啉"], category: "消化类", riskLevel: "⚠️ 12岁慎用", riskColor: "bg-yellow-500 text-white", harm: "心脏猝死(QT间期延长)。", consequence: "欧美限制使用。", alternatives: "益生菌" },
            { id: 35, name: "西布曲明", abbr: "Sibutramine", aliases: ["减肥药"], category: "减肥药", riskLevel: "❌ 全球禁用", riskColor: "bg-red-600 text-white", harm: "增加心脏病和中风风险。", consequence: "已注销。", alternatives: "运动" },
            { id: 36, name: "强效激素膏", abbr: "Steroids", aliases: ["氯倍他索", "特美肤"], category: "皮肤外用", riskLevel: "⚠️ 儿童慎用", riskColor: "bg-orange-500 text-white", harm: "皮肤萎缩，激素依赖，抑制生长。", consequence: "应选弱效激素。", alternatives: "尤卓尔" },
            { id: 37, name: "林旦乳膏", abbr: "Lindane", aliases: ["六六六"], category: "皮肤外用", riskLevel: "❌ 禁用", riskColor: "bg-red-600 text-white", harm: "中枢神经毒性，诱发癫痫。", consequence: "已淘汰。", alternatives: "硫软膏" },
            { id: 38, name: "硼酸/硼砂", abbr: "Borip", aliases: ["硼酸"], category: "皮肤外用", riskLevel: "❌ 婴幼儿禁用", riskColor: "bg-red-600 text-white", harm: "蓄积中毒，大面积使用致死。", consequence: "禁用。", alternatives: "氧化锌" },
            { id: 39, name: "一滴香(蚊香)", abbr: "Poison", aliases: ["一滴香", "氟虫腈"], category: "外用", riskLevel: "⚠️ 剧毒", riskColor: "bg-orange-500 text-white", harm: "农药成分，神经毒性。", consequence: "慎用。", alternatives: "电蚊香液" }
        ];

        const App = () => {
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedCategory, setSelectedCategory] = useState("全部");
            const [expandedId, setExpandedId] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [scanProgress, setScanProgress] = useState(0);
            const [foundDrug, setFoundDrug] = useState(null); // 存储识别到的结果
            
            const fileInputRef = useRef(null);

            const categories = ["全部", "退烧止痛", "抗生素", "止咳/止吐", "抗病毒", "中药注射", "消化/其他"];

            // 过滤逻辑
            const filteredDrugs = drugDatabase.filter(drug => {
                const lowerSearch = searchTerm.toLowerCase();
                const matchesSearch = drug.name.toLowerCase().includes(lowerSearch) || 
                                      drug.aliases.some(alias => alias.toLowerCase().includes(lowerSearch)) ||
                                      (drug.abbr && drug.abbr.toLowerCase().includes(lowerSearch));
                const matchesCategory = selectedCategory === "全部" || drug.category === selectedCategory || (selectedCategory === "消化/其他" && ["消化类", "减肥药", "皮肤外用", "其他"].includes(drug.category));
                return matchesSearch && matchesCategory;
            });

            // 真实本地 OCR 处理
            const handleImage = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setIsAnalyzing(true);
                setScanProgress(0);
                setSearchTerm("");
                setFoundDrug(null);
                setExpandedId(null);

                try {
                    const worker = await Tesseract.createWorker({
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                setScanProgress(parseInt(m.progress * 100));
                            }
                        }
                    });
                    
                    // 加载中英文语言包 (国内环境第一次加载会从CDN下载)
                    await worker.loadLanguage('eng+chi_sim');
                    await worker.initialize('eng+chi_sim');
                    
                    const { data: { text } } = await worker.recognize(file);
                    await worker.terminate();

                    analyzeText(text);

                } catch (error) {
                    console.error(error);
                    alert("首次加载识别组件可能较慢，请确保网络通畅。");
                    setIsAnalyzing(false);
                }
            };

            const analyzeText = (text) => {
                // 简单的关键词匹配逻辑
                const cleanText = text.replace(/\s+/g, "").toUpperCase();
                
                // 遍历数据库查找匹配
                const matched = drugDatabase.find(drug => {
                    // 匹配中文名
                    if (cleanText.includes(drug.name.replace(/\(.*\)/, ""))) return true;
                    // 匹配缩写 (需精确一点，防止误判，如 GM)
                    if (drug.abbr && cleanText.includes(drug.abbr.toUpperCase())) return true;
                    // 匹配别名
                    return drug.aliases.some(alias => cleanText.includes(alias.toUpperCase()));
                });

                if (matched) {
                    setSearchTerm(matched.name); // 填入搜索框
                    setFoundDrug(matched);       // 标记找到的药
                    setExpandedId(matched.id);   // 自动展开
                } else {
                    alert("未在图片中识别到黑名单药物。\n(但这不代表绝对安全，请以说明书为准)");
                }
                setIsAnalyzing(false);
            };

            return (
                <div className="min-h-screen flex flex-col pb-12 bg-slate-50">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-purple-900 to-indigo-900 text-white sticky top-0 z-50 shadow-lg">
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/10 p-1.5 rounded-lg backdrop-blur-sm border border-white/20">
                                    <Icons.Shield />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold leading-none tracking-tight">家庭用药避坑指南</h1>
                                    <p className="text-[10px] text-yellow-200 mt-1 uppercase tracking-wider">AI Ultimate (50+)</p>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Search Hero */}
                    <div className="bg-white pb-8 pt-6 px-4 rounded-b-[2.5rem] shadow-sm mb-6 border-b border-gray-200">
                        <div className="container mx-auto max-w-3xl">
                            <div className="text-center mb-5">
                                <h2 className="text-xl font-bold text-slate-800 mb-1">50+种高危药 · 拍照即查</h2>
                                <p className="text-slate-500 text-xs">支持处方单缩写识别 (AKC, DXM) 及相册上传</p>
                            </div>
                            
                            <div className="relative flex gap-2">
                                <div className="relative flex-1">
                                    <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                        <Icons.Search />
                                    </div>
                                    <input
                                        type="text"
                                        className="block w-full pl-11 pr-4 py-4 rounded-2xl text-base bg-slate-100 border-2 border-transparent focus:border-purple-500 focus:bg-white transition-all outline-none placeholder-slate-400"
                                        placeholder="输入药名或缩写..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                
                                <button 
                                    onClick={() => fileInputRef.current.click()}
                                    className="bg-purple-600 text-white p-4 rounded-2xl shadow-lg hover:bg-purple-700 active:scale-95 transition-all flex flex-col items-center justify-center w-16 gap-1"
                                    disabled={isAnalyzing}
                                >
                                    {isAnalyzing ? (
                                        <div className="loader"></div>
                                    ) : (
                                        <>
                                            <div className="flex gap-1">
                                                <Icons.Camera />
                                                <Icons.Image />
                                            </div>
                                            <span className="text-[9px] font-bold">识别</span>
                                        </>
                                    )}
                                </button>
                                <input type="file" ref={fileInputRef} accept="image/*" className="hidden" onChange={handleImage} />
                            </div>

                            {/* Pills */}
                            <div className="flex flex-wrap justify-center gap-2 mt-5">
                                {categories.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => setSelectedCategory(cat)}
                                        className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-200 border ${
                                            selectedCategory === cat 
                                                ? 'bg-purple-600 text-white border-purple-600 shadow-md' 
                                                : 'bg-white text-slate-600 border-gray-200 hover:bg-gray-50'
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 max-w-4xl space-y-4">
                        
                        {/* Scanning Status */}
                        {isAnalyzing && (
                            <div className="flex flex-col items-center justify-center py-8 bg-purple-50 rounded-xl border border-purple-100 relative overflow-hidden">
                                <div className="scan-line"></div>
                                <p className="text-purple-700 text-sm font-medium mt-4">AI 正在扫描文字... {scanProgress}%</p>
                                <p className="text-purple-400 text-xs">首次加载需要下载语言包(约10MB)，请耐心等待</p>
                            </div>
                        )}

                        {filteredDrugs.length === 0 && !isAnalyzing ? (
                            <div className="text-center py-16">
                                <p className="text-gray-500 font-medium">未找到相关风险药物</p>
                                <p className="text-xs text-gray-400 mt-1">库中暂无此药，或请输入通用名尝试。</p>
                            </div>
                        ) : (
                            filteredDrugs.map((drug) => (
                                <div key={drug.id} className={`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all duration-300 group ${foundDrug?.id === drug.id ? 'ring-2 ring-purple-500' : ''}`}>
                                    {/* Header */}
                                    <div 
                                        className="p-4 flex justify-between items-start cursor-pointer select-none active:bg-gray-50"
                                        onClick={() => setExpandedId(expandedId === drug.id ? null : drug.id)}
                                    >
                                        <div className="flex-1">
                                            <div className="flex flex-wrap items-center gap-2 mb-2">
                                                {drug.abbr && (
                                                    <span className="flex items-center gap-1 bg-slate-800 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm tracking-wide">
                                                        {drug.abbr}
                                                    </span>
                                                )}
                                                <h3 className="text-lg font-bold text-slate-900 group-hover:text-purple-700 transition-colors">
                                                    {drug.name}
                                                </h3>
                                            </div>
                                            
                                            <div className="mb-2">
                                                <span className={`inline-flex items-center gap-1.5 text-xs px-2.5 py-1 rounded-md font-bold shadow-sm ${drug.riskColor}`}>
                                                    {drug.riskLevel.includes("❌") ? <Icons.AlertTriangle /> : <Icons.Alert />}
                                                    {drug.riskLevel}
                                                </span>
                                            </div>

                                            <p className="text-xs text-slate-500">
                                                <span className="font-semibold text-slate-400">别名:</span> {drug.aliases.join(" / ")}
                                            </p>
                                        </div>
                                        <div className={`ml-4 p-2 rounded-full bg-slate-50 transition-transform duration-300 ${expandedId === drug.id ? 'rotate-180 bg-slate-200' : ''}`}>
                                            <Icons.ChevronDown />
                                        </div>
                                    </div>

                                    {/* Content */}
                                    {expandedId === drug.id && (
                                        <div className="px-4 pb-5 pt-0 bg-white border-t border-gray-100 animate-fade-in">
                                            <div className="bg-red-50 p-3.5 rounded-lg border-l-4 border-red-500 mt-4">
                                                <h4 className="text-xs font-bold text-red-700 mb-1 flex items-center gap-1">
                                                    <Icons.Close /> 核心危害
                                                </h4>
                                                <p className="text-sm text-slate-700 font-medium leading-snug">
                                                    {drug.harm}
                                                </p>
                                            </div>

                                            <div className="mt-3 bg-slate-100 p-3 rounded-lg flex items-start gap-2 border border-slate-200">
                                                <Icons.Gavel className="w-4 h-4 text-slate-500 mt-0.5 shrink-0" />
                                                <div>
                                                    <span className="text-xs font-bold text-slate-700 block">禁令/政策依据：</span>
                                                    <span className="text-xs text-slate-600 block mt-0.5 leading-relaxed">{drug.consequence} <br/> <span className="text-slate-400">({drug.source})</span></span>
                                                </div>
                                            </div>

                                            <div className="mt-3 bg-emerald-50 p-3.5 rounded-lg border border-emerald-100">
                                                <h4 className="text-xs font-bold text-emerald-700 mb-1 flex items-center gap-1">
                                                    <Icons.Shield /> 安全替代
                                                </h4>
                                                <p className="text-sm text-slate-700">{drug.alternatives}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))
                        )}
                    </main>

                    <footer className="text-center text-slate-400 text-[10px] py-10">
                        <p>SafeMed AI Ultimate | 依据国家药监局公告整理</p>
                    </footer>
                </div>
            );
        };

        // 修复：手动定义 Gavel 图标组件，因为之前 Icons 对象里漏了
        Icons.Gavel = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72l1.189-1.19A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z"></path></svg>;

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
